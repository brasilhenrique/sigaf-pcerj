<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Folha de Ponto - {{ folha.servidor.nome }}</title>
    <style>
        @page { size: A4 landscape; margin: 1cm; }
        @media print { .folha-ponto { page-break-after: always; } }
        body { font-family: 'Helvetica', Arial, sans-serif; font-size: 8pt; color: #000; }
        .folha-ponto { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .master-table { width: 100%; border-collapse: collapse; }
        .master-table td, .master-table th { border: 1px solid black; padding: 4px; vertical-align: top; }
        .brasao-container { text-align: center; padding: 5px 0; } /* Ajustado padding */
        .brasao-container img { width: 55px; height: auto; } /* Diminuído o tamanho do brasão */

        /* Estilos para o novo cabeçalho */
        .header-section { text-align: center; font-weight: bold; margin-bottom: 5px; }
        .header-section.gov { font-size: 9pt; } /* Um pouco maior */
        .header-section.cartao { font-size: 10pt; margin-top: 10px; } /* Destaque para o título do cartão */
        .header-section.policia-civil { font-size: 9pt; margin-top: 10px; } /* Informações da PCERJ */
        .header-section.policia-civil span { font-weight: normal; } /* Nome da UA em normal */
        .header-section.servidor-info { font-size: 9pt; margin-top: 10px; } /* Informações do servidor */
        .header-section.servidor-info span { font-weight: normal; } /* Nomes e cargos em normal */
        
        .no-border { border: none !important; }
        .month-header { background-color: #E0E0E0; font-weight: bold; text-align: center; }
        .day-header { background-color: #E0E0E0; font-weight: bold; text-align: center; font-size: 7.5pt; }
        .day-cell { text-align: center; font-size: 8pt; vertical-align: middle; font-weight: bold; }
        .separator-col { border-right: 1px solid black !important; width: 1%; background-color: #f0f0f0; }
        .signature-cell { text-align: center; font-size: 6.5pt; line-height: 1.2; word-break: break-word; vertical-align: middle;}
        .ocorrencia-cell {
            text-align: center;
            font-weight: bold;
            font-size: 8pt;
            background-color: #f8f9fa;
            vertical-align: middle;
        }
        .pendente-assinatura {
            color: #888;
            font-style: italic;
            font-size: 7pt;
        }
    </style>
</head>
<body>
    <div class="folha-ponto">
        <table class="master-table">
            <thead>
                <tr>
                    <td colspan="10" class="no-border">
                        <div class="brasao-container">
                             <img src="{{ imagem_path }}" alt="Brasão da PCERJ">
                        </div>
                        <div class="header-section gov">
                            GOVERNO DO ESTADO DO RIO DE JANEIRO<br>
                            Secretaria de Estado da Casa Civil
                        </div>
                        <div class="header-section cartao">
                            CARTÃO DE FREQUÊNCIA TRIMESTRAL - {{ folha.get_trimestre_display|upper }} / {{ folha.ano }}
                        </div>
                        <div class="header-section policia-civil">
                            SECRETARIA DE ESTADO DE POLÍCIA CIVIL<br>
                            UA: <span>{{ folha.servidor.lotacao.nome_unidade|upper|default:"NÃO INFORMADA" }}</span><br>
                            Código: <span>{{ folha.servidor.lotacao.codigo_ua|default:"NÃO INFORMADO" }}</span>
                        </div>
                        <div class="header-section servidor-info">
                            ID FUNCIONAL: <span>{{ folha.servidor.id_funcional }}</span><br>
                            <span>{{ folha.servidor.nome }}</span><br>
                            <span>{{ folha.servidor.perfil|upper }}</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th rowspan="2" class="day-header" style="vertical-align: middle;">DIA</th>
                    <th colspan="3" class="month-header">{{ meses.0|upper }}</th>
                    <th colspan="3" class="month-header">{{ meses.1|upper }}</th>
                    <th colspan="3" class="month-header">{{ meses.2|upper }}</th>
                </tr>
                <tr>
                    <th class="day-header">ASSINATURA</th> <th class="day-header">CONFERÊNCIA</th> <th class="separator-col day-header"></th>
                    <th class="day-header">ASSINATURA</th> <th class="day-header">CONFERÊNCIA</th> <th class="separator-col day-header"></th>
                    <th class="day-header">ASSINATURA</th> <th class="day-header">CONFERÊNCIA</th> <th class="day-header" style="width:1%;"></th>
                </tr>
            </thead>
            <tbody>
                {% for linha in linhas_tabela %}
                <tr>
                    <td class="day-cell">{{ linha.dia }}</td>
                    {% for dia_obj in linha.meses %}
                        {% if dia_obj %}
                            {% if dia_obj.codigo.codigo.lower == 'livre' %}
                                <td class="signature-cell">
                                    {% if dia_obj.servidor_assinou %}
                                        {{ folha.servidor.nome }}<br>
                                        ID nº {{ folha.servidor.id_funcional }}
                                    {% else %}
                                        <span class="pendente-assinatura">Pendente de Assinatura</span>
                                    {% endif %}
                                </td>
                                <td class="signature-cell">
                                    {% if dia_obj.delegado_conferiu %}
                                        {{ dia_obj.delegado.nome }}<br>
                                        ID nº {{ dia_obj.delegado.id_funcional }}
                                    {% else %}
                                        <span class="pendente-assinatura">Pendente de Conferência</span>
                                    {% endif %}
                                </td>
                            {% else %}
                            <td colspan="2" class="ocorrencia-cell">
                                {% if dia_obj.codigo.codigo %}
                                    {{ dia_obj.codigo.denominacao }} - CÓDIGO {{ dia_obj.codigo.codigo }}
                                {% else %}
                                    {{ dia_obj.codigo.denominacao }} - CÓDIGO N/A
                                {% endif %}
                            </td>
                            {% endif %}
                            <td class="separator-col"></td>
                        {% else %}
                            <td colspan="3" class="separator-col"></td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {# Seção de Observações #}
        {% if folha.observacoes %}
        <div style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; background-color: #f9f9f9;">
            <p style="font-weight: bold; margin-bottom: 5px;">Observações:</p>
            <p style="white-space: pre-wrap; margin-bottom: 0;">{{ folha.observacoes }}</p>
        </div>
        {% endif %}

    </div> {# Fecha a div folha-ponto #}
</body>
</html>